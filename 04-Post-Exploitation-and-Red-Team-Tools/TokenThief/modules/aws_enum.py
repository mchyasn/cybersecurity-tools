import boto3
import os

def extract_aws_tokens(verbose=False):
    session = boto3.Session()
    creds = session.get_credentials()
    if not creds:
        print("[!] No AWS credentials found in environment or config.")
        return

    creds = creds.get_frozen_credentials()
    data = {
        "AWS_ACCESS_KEY_ID": creds.access_key,
        "AWS_SECRET_ACCESS_KEY": creds.secret_key,
        "AWS_SESSION_TOKEN": creds.token
    }

    if verbose:
        print("[*] Extracted AWS credentials:")
        for k, v in data.items():
            print(f"    {k}: {v}")

    os.makedirs("output", exist_ok=True)
    with open("output/aws_tokens.txt", "w") as f:
        for k, v in data.items():
            f.write(f"{k}={v}\n")
