import argparse
from modules.loader import load_binary
from modules.diff import diff_binaries
from modules.reporter import generate_report

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="BinDiffTracer - Binary Diff and Patch Analysis Tool")
    parser.add_argument("-o", "--old", required=True, help="Path to original/malicious binary")
    parser.add_argument("-n", "--new", required=True, help="Path to patched binary")
    parser.add_argument("-c", "--config", default="configs/config.yaml", help="YAML config file")
    args = parser.parse_args()

    print("[+] Loading binaries...")
    old_instrs = load_binary(args.old)
    new_instrs = load_binary(args.new)

    print("[+] Running binary diff...")
    delta = diff_binaries(old_instrs, new_instrs)

    print("[+] Generating annotated report...")
    generate_report(delta)
