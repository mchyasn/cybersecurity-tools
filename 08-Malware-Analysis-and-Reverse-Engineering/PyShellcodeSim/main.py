import argparse
from modules.emulator import emulate_shellcode
from modules.disassembler import disassemble_shellcode

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="PyShellcodeSim - Shellcode Emulator and Disassembler")
    parser.add_argument("-s", "--shellcode", required=True, help="Path to shellcode file (raw bytes)")
    parser.add_argument("-a", "--arch", choices=["x86", "x64"], default="x86", help="Architecture (default: x86)")
    parser.add_argument("-m", "--mode", choices=["emulate", "disasm", "both"], default="both", help="Execution mode")
    args = parser.parse_args()

    with open(args.shellcode, "rb") as f:
        shellcode = f.read()

    if args.mode in ("disasm", "both"):
        print("[*] Disassembly:")
        disassemble_shellcode(shellcode, args.arch)

    if args.mode in ("emulate", "both"):
        print("[*] Emulation:")
        emulate_shellcode(shellcode, args.arch)
