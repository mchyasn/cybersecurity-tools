import yara
import os

def test_rule(rule_path, samples_dir):
    matches = {}
    try:
        rules = yara.compile(filepath=rule_path)
    except yara.SyntaxError as e:
        return {"error": f"Syntax error: {e}"}
    for fname in os.listdir(samples_dir):
        path = os.path.join(samples_dir, fname)
        try:
            res = rules.match(path)
            if res:
                matches[fname] = [r.rule for r in res]
        except Exception as e:
            matches[fname] = [str(e)]
    return matches
