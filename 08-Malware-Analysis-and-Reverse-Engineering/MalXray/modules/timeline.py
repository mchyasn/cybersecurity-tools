import json, yaml
from datetime import datetime

def generate_report(log_path):
    with open("configs/config.yaml") as f:
        cfg = yaml.safe_load(f)

    with open(log_path, "r") as f:
        lines = f.readlines()

    events = []
    for line in lines:
        if "Simulated event" in line:
            ts = datetime.now().isoformat()
            events.append({"timestamp": ts, "event": line.strip()})

    json_out = cfg["report"]["json_output"]
    html_out = cfg["report"]["html_output"]

    # Write JSON report
    with open(json_out, "w") as jf:
        json.dump(events, jf, indent=2)

    # Write HTML report
    with open(html_out, "w") as hf:
        hf.write("<html><body><h1>MalXray Timeline</h1><ul>")
        for e in events:
            hf.write(f"<li>{e['timestamp']} - {e['event']}</li>")
        hf.write("</ul></body></html>")
