import requests
import yaml

def check_virustotal(file_path):
    with open("config/config.yml") as f:
        config = yaml.safe_load(f)
    api_key = config.get("vt_api_key")
    if not api_key or "PASTE_YOUR_API_KEY" in api_key:
        return {"vt_result": "API key not set"}

    with open(file_path, "rb") as f:
        files = {"file": (file_path, f)}
        headers = {"x-apikey": api_key}
        response = requests.post("https://www.virustotal.com/api/v3/files", headers=headers, files=files)

    if response.status_code == 200:
        analysis_id = response.json()["data"]["id"]
        return {"vt_result": f"Submitted. Analysis ID: {analysis_id}"}
    else:
        return {"vt_result": f"Error: {response.status_code}"}
