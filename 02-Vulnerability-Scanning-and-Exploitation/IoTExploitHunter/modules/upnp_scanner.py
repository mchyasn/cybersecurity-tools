from scapy.all import *

def scan_upnp():
    print("[*] Scanning for UPnP (SSDP) devices on 239.255.255.250:1900...")
    ssdp_discover = (
        "M-SEARCH * HTTP/1.1\r\n"
        "HOST: 239.255.255.250:1900\r\n"
        "MAN: \"ssdp:discover\"\r\n"
        "MX: 2\r\n"
        "ST: ssdp:all\r\n"
        "\r\n"
    )

    pkt = IP(dst="239.255.255.250")/UDP(sport=1901,dport=1900)/Raw(load=ssdp_discover)

    ans, _ = sr(pkt, timeout=3, verbose=0)
    if ans:
        print("[+] UPnP devices found:")
        for snd, rcv in ans:
            print(f"    - {rcv[IP].src} | {rcv[Raw].load.decode(errors='ignore').splitlines()[0]}")
    else:
        print("[-] No UPnP responses detected.")
