import r2pipe
import json

def get_disasm_blocks(binary_path):
    r2 = r2pipe.open(binary_path)
    r2.cmd('aaa')
    funcs = r2.cmdj('aflj')
    disasm = {}

    if funcs:
        for f in funcs:
            name = f.get('name')
            r2.cmd(f"s {f['offset']}")
            ops = r2.cmdj('pdfj')['ops']
            if ops:
                disasm[name] = [op['mnemonic'] for op in ops if 'mnemonic' in op]

    r2.quit()
    return disasm

def compare_disassembled_funcs(dis1, dis2):
    modified = {}

    common_funcs = set(dis1.keys()) & set(dis2.keys())
    for fname in common_funcs:
        if dis1[fname] != dis2[fname]:
            modified[fname] = {
                "before": dis1[fname],
                "after": dis2[fname]
            }

    return modified
