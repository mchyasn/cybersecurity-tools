from impacket.smbconnection import SMBConnection
import socket

class SMBGhostScanner:
    def __init__(self, target_ip):
        self.target_ip = target_ip

    def run(self):
        try:
            conn = SMBConnection(self.target_ip, self.target_ip, timeout=3)
            conn.login("", "")  # anonymous login
            dialect = conn.getDialect()
            conn.close()

            # SMBv3.1.1 (0x0311) is vulnerable if compression is enabled (can't confirm compression passively)
            if dialect == 0x0311:
                return True  # Likely vulnerable SMBv3.1.1
            return False  # Older dialects are not vulnerable

        except socket.timeout:
            print("[!] Connection timed out.")
            return None
        except Exception as e:
            print(f"[!] Error: {e}")
            return None
